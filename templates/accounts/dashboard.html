{% extends 'partials/base.html' %}
{% load static %}

{% block content %}

    {% include 'partials/alerts.html' %}
  <!--=======  breadcrumb area =======-->

  <div class="breadcrumb-area breadcrumb-bg-1 pt-50 pb-70 mb-130">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <h1 class="breadcrumb-title">My Account</h1>

          <!--=======  breadcrumb list  =======-->

          <ul class="breadcrumb-list">
            <li class="breadcrumb-list__item"><a href="{% url 'home' %}">HOME</a></li>
            <li class="breadcrumb-list__item breadcrumb-list__item--active">My Account</li>
          </ul>

          <!--=======  End of breadcrumb list  =======-->

        </div>
      </div>
    </div>
  </div>

  <!--=======  End of breadcrumb area =======-->

  <!--=============================================
  =            my account page content         =
  =============================================-->

  <div class="my-account-area mb-130 mb-md-70 mb-sm-70 mb-xs-70 mb-xxs-70">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <div class="row">
            <div class="col-lg-12 col-md-12">
              <div class="myaccount-tab-menu nav" role="tablist">
                <a href="#dashboad" class="active" data-toggle="tab">
                  Dashboard</a>
                <a href="#orders" data-toggle="tab">My Orders</a>
                <a href="#download" data-toggle="tab"> My Wallet</a>
                <a href="#payment-method" data-toggle="tab"> Edit Password</a>
                <a href="#address-edit" data-toggle="tab"> address</a>
                <a href="#account-info" data-toggle="tab"> Account Details</a>
                <a href="{% url 'logout' %}"> Logout</a>
              </div>
            </div>
            <!-- My Account Tab Menu End -->
            <!-- My Account Tab Content Start -->
            <div class="col-lg-12 col-md-12">
              <div class="tab-content" id="myaccountContent">
                <!-- Single Tab Content Start -->
                <div class="tab-pane fade show active" id="dashboad" role="tabpanel">
                  <div class="myaccount-content">
                    <h3>Dashboard</h3>
                    <div class="welcome">
                      <p>Hello, <strong> {{user.first_name}} </strong> (If Not <strong>Tuntuni !</strong><a
                          href="shop-customer-login.html" class="logout"> Logout</a>)</p>
                    </div>


                    <p class="mb-0">From your account dashboard. you can easily check & view your recent orders, manage
                      your
                      shipping and billing addresses and edit your password and account details.</p>
                  </div>

                  <div class="card-body">
                    <div class="row">
                      <div class="col-md-6">
                        <div class="card">
                          <div class="card-body" style="text-align: center;">
                            <h5 class="card-title"><b>Total Orders</b></h5>
                            <h4> {{orders_count}} </h4>
                            <a href="#orders" data-toggle="tab">View Orders</a>
                          </div>
                        </div>
                      </div>
                      
                      <div class="col-md-6">
                        <div class="card">
                          <div class="card-body" style="text-align: center;">
                            {% if userprofile.profile_pic %}
                            <img src="{{ userprofile.profile_pic.url }}" alt="" width="50" height="50" style="border-radius: 50%;">
                            {% else %}
                            <img src="{% static 'images/rooted-high-resolution-logo-white.png' %}" alt="Profile pic" width="100" height="100" style="border-radius: 50%;">
                            {% endif %}
                            <p> {{user.email}} </p>
                            <p> {{user.phone}} </p>
                          </div>
                        </div>
                      </div>
                    

                    </div>
                  </div>


                </div>
                
                <!-- Single Tab Content End -->
                <!-- Single My Orders Content Start -->
                <div class="tab-pane fade" id="orders" role="tabpanel">
                  <div class="myaccount-content">
                    <h3>My Orders</h3>
                    <div class="myaccount-table table-responsive text-center">
                      <table class="table table-bordered">
                        <thead class="thead-light">
                          <tr>
                            <th>Order</th>
                            <th>Billing Name</th>
                            <th>Date</th>
                            <th>Status</th>
                            <th>Total</th>
                            <th>Invoice</th>
                            <th>Action</th>
                          </tr>
                        </thead>
                        <tbody>
                          {% for order in orders %}
                          <tr>
                            <td> {{order.id}} </td>
                            <td> {{order.full_name}} </td>
                            <td> {{order.created_at}} </td>
                            <td> {% if order.status == 'Cancelled' %} <span class="text-danger">{{order.status}} </span> {% else %} <span class="text-success">{{order.status}} </span>{% endif %}</td>
                            <td>₹ {{order.order_total|floatformat:"2"}} </td>
                            <td>
                              <a href="{% url 'order_invoice' order.order_number %}">Show</a>
                              <a href="{% url 'generate_invoice_pdf' order.order_number %}" class="btn btn-outline-secondary">PDF<i class="far fa-file-pdf"></i></a>
                              <a href="{% url 'generate_invoice_xls' order.order_number %}" class="btn btn-outline-secondary">Excel<i class="far fa-file-excel"></i></a>  
                            </td>
                            <td>
                              <a href="{% url 'order_detail' order.order_number %}" class="check-btn sqr-btn ">View</a>
                              
                            </td>
                          </tr>
                          {% endfor %}
                          
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
                <!-- Single My Orders Content End -->

                <!-- My Wallet Content Start -->
                <div class="tab-pane fade" id="download" role="tabpanel">
                  <div class="myaccount-content">
                    <h3>My Wallet</h3>
                    <div class=" text-center">
                      <div class="row">
                        
                        <div class="col-lg-4 col-md-4 col-sm-12">
                            
                        </div>
                        <div class="card text-center col-lg-4 col-md-4 col-sm-12 ">
                          <div class="card-header">
                            Wallet
                          </div>
                          <div class="card-body text-center">
                            {%if wallet%}
                            <h4 class="card-title">Total Balence</h4>
                            <div class="card-body">
                              <h3> ₹  {{wallet.balance}}</h3>
                            </div>
                            {% else %}
                            <h4 class="card-title">No Wallets for you</h4>
                            <div class="card-body ">
                                   {{wallet_message}}
                            </div>
                            {% endif %}
                            
                          </div>
                          
                        </div>
                        <div class="col-lg-4 col-md-4 col-sm-12 ">
                        </div>
                      </div>

                      <div class="myaccount-content">
                    <h3>Transaction Details</h3>
                    <div class="myaccount-table table-responsive text-center">
                      <table class="table table-bordered">
                        <thead class="thead-light">
                          <tr>
                            <th>Order</th>
                            <th>Billing Name</th>
                            <th>Type</th>
                            <th>Time</th>
                          </tr>
                        </thead>
                        <tbody>
                          {% for tran in transaction %}
                          <tr>
                            <td> {{tran.id}} </td>
                            <td> {{tran.amount}} </td>
                            <td> {{tran.type}} </td>
                            <td> {{tran.timestamp}} </td>
                          </tr>
                          {% endfor %}
                          
                        </tbody>
                      </table>
                    </div>
                  </div>
                      
                      
                    </div>
                  </div>
                </div>
                <!--  My Wallet Content End -->
                
                <!-- Single Edit Password Content Start -->
                <div class="tab-pane fade" id="payment-method" role="tabpanel">
                  <div class="myaccount-content">
                    <h3>Edit Password</h3>
                    <p class="saved-message">You Can Cahnge your password.</p>
                  
                    <form action="{% url 'change_password' %}" method="POST">
                    {% csrf_token %}
                      <fieldset>
                        <legend>Password change</legend>
                        <div class="single-input-item">
                          <label for="current_password" class="required">Current Password</label>
                          <input type="password" id="current_password" name="current_password" class="form-controle" placeholder="Current Password" />
                        </div>
                        <div class="row">
                          <div class="col-lg-6">
                            <div class="single-input-item">
                              <label for="new_password" class="required">New Password</label>
                              <input type="password" id="new_password" name="new_password" class="form-controle" placeholder="New Password" />
                            </div>
                          </div>
                          <div class="col-lg-6">
                            <div class="single-input-item">
                              <label for="confirm_password" class="required">Confirm Password</label>
                              <input type="password" id="confirm_password" name="confirm_password" class="form-controle" placeholder="Confirm Password" />
                            </div>
                          </div>
                        </div>
                      </fieldset>
                      <div class="single-input-item">
                        <button class="check-btn sqr-btn" type="submit" >Save Changes</button>
                      </div>
                    
                    </form>

                  </div>
                </div>
                <!-- Single Edit Password Content End -->
                
                <!-- Single Address Content Start -->
                <div class="tab-pane fade" id="address-edit" role="tabpanel">
                  <div class="myaccount-content">
                    <h3>Billing Address</h3> 
                    
                    <div class="row">
                      {% for i in address %}
                      <div class="col-12 col-md-6 col-lg-6">
                        <div class="card mb-3">
                          <div class="card-header">
                            <h4>{{i.full_name}}</h4>
                          </div>

                          <div class="card-body">
                            <p>{{i.address_line_1}}</p>
                            <p>{{i.address_line_2}}</p>
                            <div class="d-flex justify-content-between">
                              <p><b>City: </b> {{i.city}}</p>
                              <p><b>State: </b> {{i.state}} </p> 
                              <p><b>Country: </b> {{i.country}} </p>
                            </div>
                            <div class="d-flex justify-content-between">
                              <p><b>PIN: </b> {{i.pin_code}} </p>
                              <p><b>Email: </b> {{i.email}} </p>
                              <p><b>Mobile:</b>{{i.phone}}</p>  
                            </div>
                            
                          </div>
                          <div class="card-footer">
                            <a href="#" class="check-btn sqr-btn "><i class="fa fa-edit"></i> Edit Address</a>
                          </div>
                        </div>
                        
                      </div>
                      {% endfor %}
                    </div>
                    <div class="col-lg-12 text-center mt-30">
                      <a class="lezada-button lezada-button--medium lezada-button--icon--left" href="#"><i class="ion-android-add"></i> Add New</a>
                    </div>
                  </div>
                
                </div>
                <!-- Single Address Content End -->

                <!-- Single Account Details Content Start -->
                <div class="tab-pane fade" id="account-info" role="tabpanel">
                  <div class="myaccount-content">
                    <h3>Account Details</h3>
                    <div class="account-details-form">
                    
                      <div class="text-right">
                        {% if userprofile.profile_pic %}
                        <img src="{{ userprofile.profile_pic.url }}" alt="Profile Picture" width="100" height="100" style="border-radius: 50%;">
                        {% else %}
                        <img src="{% static 'images/rooted-high-resolution-logo-white.png' %}" alt="Profile pic" width="100" height="100" style="border-radius: 50%;">
                        {% endif %}
                        
                      </div>
                      
                      <form action="{% url 'edit_profile' %}" method="POST" enctype="multipart/form-data">
                        {% csrf_token %}
                        <div class="row">
                          <div class="col-lg-6">
                            <div class="single-input-item">
                              <label for="first-name"  class="required">First Name</label>
                              {{user_form.first_name}}
                            </div>
                          </div>
                          <div class="col-lg-6">
                            <div class="single-input-item">
                              <label for="last-name" class="required">Last Name</label>
                              {{user_form.last_name}}
                            </div>
                          </div>
                        </div>

                        <div class="row">
                          <div class="col-lg-6">
                            <div class="single-input-item">
                              <label for="phone"  class="required">Phone Number</label>
                              {{user_form.phone_number}}
                            </div>
                          </div>
                          <div class="col-lg-6">
                            <div class="single-input-item">
                              <label for="profile_pic" class="required">Profile picture </label>
                              {{profile_form.profile_pic}}
                            </div>
                          </div>
                        </div>
                        <div class="single-input-item">
                          <label for="email" class="required">Email Addres</label>
                          {{user_form.email}}
                        </div>
                        <div class="single-input-item">
                          <label for="address_line_1" class="required">Address</label>
                          {{profile_form.address_line_1}}
                        </div><div class="single-input-item">
                          <label for="address_line_2" class="required">Address line 2</label>
                          {{profile_form.address_line_2}}
                        </div>
                        <div class="row">
                          <div class="col-lg-4">
                            <div class="single-input-item">
                              <label for="city"  class="required">City</label>
                              {{profile_form.city}}
                            </div>
                          </div>
                          <div class="col-lg-4">
                            <div class="single-input-item">
                              <label for="state"  class="required">State</label>
                              {{profile_form.state}}
                            </div>
                          </div>
                          <div class="col-lg-4">
                            <div class="single-input-item">
                              <label for="country"  class="required">Country</label>
                              {{profile_form.country}}
                            </div>
                          </div>
                        </div>
                        
                        <!--<fieldset>
                          <legend>Password change</legend>
                          <div class="single-input-item">
                            <label for="current-pwd" class="required">Current Password</label>
                            <input type="password" id="current-pwd" />
                          </div>
                          <div class="row">
                            <div class="col-lg-6">
                              <div class="single-input-item">
                                <label for="new-pwd" class="required">New Password</label>
                                <input type="password" id="new-pwd" />
                              </div>
                            </div>
                            <div class="col-lg-6">
                              <div class="single-input-item">
                                <label for="confirm-pwd" class="required">Confirm Password</label>
                                <input type="password" id="confirm-pwd" />
                              </div>
                            </div>
                          </div>
                        </fieldset>-->
                        <div class="single-input-item">
                          <button class="check-btn sqr-btn" type="submit" >Save Changes</button>
                        </div>
                      </form>

                    </div>
                  </div>
                </div>
                 <!-- Single Account Details Content End -->
                
              </div>
            </div> 
            <!-- My Account Tab Content End -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!--=====  End of my account page content  ======-->




{% endblock content %}